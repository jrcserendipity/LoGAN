
The code is designed for detailed monocualr terrain reconstruction of the Martian surface. Below are the detailed descriptions and guidelines for running the code.

### 1. Installation
This code is tested with Python 3.11. Please install the dependencies according to ``requirement.txt``.
```
conda create -n LoGAN python=3.11
conda activate LoGAN
pip install -r requirements.txt
```

### 2. Code Structure
The code folder contains the following files:
* **Network_model.py**: Code for the LoGAN's network model architecture.
* **Relative_height_inference.py**: Code for relative height inference using trained network model.
  * Line 40-46: _Filepaths of input images and output results._
* **Post_process.py**: Code for post-processing where the relative heights are restored to absolute heights.
  * Line 60-62: _Input filepaths of high-resolution image (Line 60), relative height results generated by the network model (Line 61) and reference low-resolution DTMs (Line 62)._
  * Line 68: _Output filepath of generated DTMs._
* **requirement.txt**：Code implementation environment.
* **README.md**: an overview of the code and instructions for its usage.
* **relative_height_test_sample**: Sample data used to test the trained network model.
  * **ORI**: input image samples
  * **GT**：ground truth samples for reference
  * **RESULT**：Results using ``Relative_height_inference.py`` and the trained network model (can be downloaded in [cloud file storage](https://pan.quark.cn/s/1def49d6dc86 "Quark pan") ``\LOGAN DTM\model``).
* **absolute_height_test_sample**: Sample data used to demonstrate the entire height reconstruction process.
  * **High_resolution_ORI**: high-resolution image samples
  * **Low_resolution_DTM**：reference low-resolution DTM samples
  * **Rel_Result**：relative height results using ``Relative_height_inference.py`` 
  * **Abs_Result**：absolute height results using ``Post_process.py``

### 3. Terrain reconstruction
A complete terrain reconstruction pipeline can be divided into three steps:
* **Stage 1:  Pre-process:** registered, cropped, and standardized
* **Stage 2:  Deep learning-based height inference: LoGAN.**
  * Using the trained network model to generative relative height.
  * Quick test can be performed using the data in the ``relative_height_test_sample``.
    
    ```
    python Relative_height_inference.py
    ```
* **Stage 3: Post-process:**
  * geometric information, projection information, and scale factor recovery.
    * Introduce the reference low-resolution terrain model to recover the missing scale and projection information.
    * Quick test can be performed using the data in the ``absolute_height_test_sample``.
      
      ```
      python Post_process.py
      ```  
   * DTM tiles splicing: splice the generated DTM tiles recovered to absolute scale together.
       * using the ``DTM_mosaic`` in [Ames Stereo Pipeline (ASP)](https://stereopipeline.readthedocs.io/en/latest/tools/dem_mosaic.html "dem_mosaic")

         ```
         dem_mosaic -l file_list.txt -o Final_result.tif
         ``` 
     
The trained network model and terrain model are available at [cloud file storage](https://pan.quark.cn/s/1def49d6dc86 "Quark pan")
The HiRISE ORI and DTM products are available at [HiRISE website](https://www.uahirise.org/dtm/ "HiRISE Data").
The train dataset is available at [published address](https://liveuclac-my.sharepoint.com/personal/ucasyta_ucl_ac_uk/_layouts/15/onedrive.aspx?id=%2Fpersonal%2Fucasyta%5Fucl%5Fac%5Fuk%2FDocuments%2FMADNet2%2E0%2Dsupplementary&ga=1 "Mars HiRISE image-height dataset") provided by Tao et al. (2021).

References:

Tao Y, Muller J P, Xiong S, et al. MADNet 2.0: Pixel-scale topography retrieval from single-view orbital imagery of Mars using deep learning[J]. Remote Sensing, 2021, 13(21): 4220.


### 4. Contact Information 

This code is about the paper: ``LoGAN: A novel local attentive generative adversarial resizable network for detailed 3D reconstruction of the Martian surface using monocular HiRISE images and DTMs``.

For questions or issues regarding this code, please contact: ``caojiarui@tongji.edu.cn`` . 
